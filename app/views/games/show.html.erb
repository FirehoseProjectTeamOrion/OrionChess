<script>
  $(function() {
    $('.piece').draggable();
    $('td').droppable({
      drop: function(ev, ui) {
        var valid_move = false;

        $.ajax({
          type: 'PUT',
          async: false,
          url: ui.draggable.data('update-url'),
          data: {piece: {row: $(this).parent().index(), column: $(this).index()}}
        }).done(function( data ) {
          valid_move = true;
        })

        if (valid_move) {
          $(ui.draggable).detach().css({top: 0, left: 0}).appendTo(this);
        } else {
          ui.draggable.draggable('option', 'revert', true);
        }
      }
    });
  })
</script>

<p id="notice"><%= notice %></p>

<p>
  <strong>Name:</strong>
</p>

<table id="chessboard">
  <% (0..7).each do |row| %>
  <tr>
      <% (0..7).each do |col| %>
      <td>
        <%= draw_piece(@game, row, col) %>
      </td>
    <% end %>
  </tr>
  <% end %>
</table>

<%= link_to 'Edit', edit_game_path(@game) %> |
<%= link_to 'Back', games_path %>
