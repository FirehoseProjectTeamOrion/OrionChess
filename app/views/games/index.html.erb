<script>
  $(function() {
    var playerColor;
    $('#new-game .piece-color').on('click', function() {
      $('#new-game span.selected').removeClass('selected');
      $(this).addClass('selected');

      $('#create-game').prop('disabled', false);

      if ($(this).text() === 'k') {
        playerColor = 'white';
      } else {
        playerColor = 'black';
      }
    });

    $('#create-game').on('click', function(event) {
      event.preventDefault();
      $.ajax({
        type: 'POST',
        url: '<%= games_path %>',
        dataType: 'json',
        data: { color: playerColor, user_id: $(this).data("user-id") }
      }).done(function(data) {
        $('#new-game').modal('hide');
        window.location.href = data.redirect;
      });
    });
  });
</script>

<h1>Listing games</h1>

<table>
  <thead>
    <tr>
      <th>Name</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>

  <tbody>
    <% @games.each do |game| %>
      if game.available? do
        <tr>
          <!--<td><#%= game.name %></td>-->
          <td><%= link_to 'Join', game_path(game, :game=>{:black_player_id => current_user.id}), :method => :update %></td>
          <td><%= link_to 'Show', game %></td>
          <td><%= link_to 'Edit', edit_game_path(game) %></td>
          <td><%= link_to 'Destroy', game, method: :delete, data: { confirm: 'Are you sure?' } %></td>
        </tr>

    <% end %>
  </tbody>
</table>

<br>

<%= link_to 'New Game', '#new_game', data: { toggle: 'modal', target: '#new-game' } %>

<!-- Modal -->
<div class="modal fade" id="new-game" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title text-center" id="myModalLabel">New Game</h4>
          <br />
        </div>
      <div class="modal-body">
        <h5 class="text-center">Choose Your Color:</h5>
        <div class="text-center">
          <span class="piece-color">k</span>
          <span class="piece-color">l</span>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-primary" id="create-game" disabled='disabled' data-user-id='<%= current_user.id %>'>Create Game</button>
      </div>
    </div>
  </div>
</div>
